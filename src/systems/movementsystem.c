/* movementsystem.c generated by valac 0.32.0, the Vala compiler
 * generated from movementsystem.vala, do not modify */

/* modules: sdl2 engine gee-0.8*/
/* vapidirs: ../../engine*/

#include <glib.h>
#include <glib-object.h>
#include <engine.h>
#include <float.h>
#include <math.h>
#include <SDL2/SDL_keyboard.h>
#include <gee.h>
#include <SDL2/SDL_render.h>
#include <SDL2/SDL_scancode.h>
#include <stdlib.h>
#include <string.h>


#define TYPE_MOVEMENT_SYSTEM (movement_system_get_type ())
#define MOVEMENT_SYSTEM(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), TYPE_MOVEMENT_SYSTEM, MovementSystem))
#define MOVEMENT_SYSTEM_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), TYPE_MOVEMENT_SYSTEM, MovementSystemClass))
#define IS_MOVEMENT_SYSTEM(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), TYPE_MOVEMENT_SYSTEM))
#define IS_MOVEMENT_SYSTEM_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), TYPE_MOVEMENT_SYSTEM))
#define MOVEMENT_SYSTEM_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), TYPE_MOVEMENT_SYSTEM, MovementSystemClass))

typedef struct _MovementSystem MovementSystem;
typedef struct _MovementSystemClass MovementSystemClass;
typedef struct _MovementSystemPrivate MovementSystemPrivate;

#define TYPE_CAMERA (camera_get_type ())
#define CAMERA(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), TYPE_CAMERA, Camera))
#define CAMERA_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), TYPE_CAMERA, CameraClass))
#define IS_CAMERA(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), TYPE_CAMERA))
#define IS_CAMERA_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), TYPE_CAMERA))
#define CAMERA_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), TYPE_CAMERA, CameraClass))

typedef struct _Camera Camera;
typedef struct _CameraClass CameraClass;

#define TYPE_MOVEMENT_COMPONENT (movement_component_get_type ())
#define MOVEMENT_COMPONENT(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), TYPE_MOVEMENT_COMPONENT, MovementComponent))
#define MOVEMENT_COMPONENT_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), TYPE_MOVEMENT_COMPONENT, MovementComponentClass))
#define IS_MOVEMENT_COMPONENT(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), TYPE_MOVEMENT_COMPONENT))
#define IS_MOVEMENT_COMPONENT_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), TYPE_MOVEMENT_COMPONENT))
#define MOVEMENT_COMPONENT_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), TYPE_MOVEMENT_COMPONENT, MovementComponentClass))

typedef struct _MovementComponent MovementComponent;
typedef struct _MovementComponentClass MovementComponentClass;

#define TYPE_POSITION_COMPONENT (position_component_get_type ())
#define POSITION_COMPONENT(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), TYPE_POSITION_COMPONENT, PositionComponent))
#define POSITION_COMPONENT_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), TYPE_POSITION_COMPONENT, PositionComponentClass))
#define IS_POSITION_COMPONENT(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), TYPE_POSITION_COMPONENT))
#define IS_POSITION_COMPONENT_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), TYPE_POSITION_COMPONENT))
#define POSITION_COMPONENT_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), TYPE_POSITION_COMPONENT, PositionComponentClass))

typedef struct _PositionComponent PositionComponent;
typedef struct _PositionComponentClass PositionComponentClass;

#define TYPE_ANIMATION_COMPONENT (animation_component_get_type ())
#define ANIMATION_COMPONENT(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), TYPE_ANIMATION_COMPONENT, AnimationComponent))
#define ANIMATION_COMPONENT_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), TYPE_ANIMATION_COMPONENT, AnimationComponentClass))
#define IS_ANIMATION_COMPONENT(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), TYPE_ANIMATION_COMPONENT))
#define IS_ANIMATION_COMPONENT_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), TYPE_ANIMATION_COMPONENT))
#define ANIMATION_COMPONENT_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), TYPE_ANIMATION_COMPONENT, AnimationComponentClass))

typedef struct _AnimationComponent AnimationComponent;
typedef struct _AnimationComponentClass AnimationComponentClass;

#define TYPE_RENDER_COMPONENT (render_component_get_type ())
#define RENDER_COMPONENT(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), TYPE_RENDER_COMPONENT, RenderComponent))
#define RENDER_COMPONENT_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), TYPE_RENDER_COMPONENT, RenderComponentClass))
#define IS_RENDER_COMPONENT(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), TYPE_RENDER_COMPONENT))
#define IS_RENDER_COMPONENT_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), TYPE_RENDER_COMPONENT))
#define RENDER_COMPONENT_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), TYPE_RENDER_COMPONENT, RenderComponentClass))

typedef struct _RenderComponent RenderComponent;
typedef struct _RenderComponentClass RenderComponentClass;
typedef struct _PositionComponentPrivate PositionComponentPrivate;

#define POSITION_COMPONENT_TYPE_ENTITY_STATE (position_component_entity_state_get_type ())
typedef struct _AnimationComponentPrivate AnimationComponentPrivate;
#define _g_free0(var) (var = (g_free (var), NULL))
typedef struct _RenderComponentPrivate RenderComponentPrivate;
#define _g_object_unref0(var) ((var == NULL) ? NULL : (var = (g_object_unref (var), NULL)))

#define TYPE_ANIMATION (animation_get_type ())
#define ANIMATION(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), TYPE_ANIMATION, Animation))
#define ANIMATION_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), TYPE_ANIMATION, AnimationClass))
#define IS_ANIMATION(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), TYPE_ANIMATION))
#define IS_ANIMATION_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), TYPE_ANIMATION))
#define ANIMATION_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), TYPE_ANIMATION, AnimationClass))

typedef struct _Animation Animation;
typedef struct _AnimationClass AnimationClass;

struct _MovementSystem {
	EngineEntitySystem parent_instance;
	MovementSystemPrivate * priv;
};

struct _MovementSystemClass {
	EngineEntitySystemClass parent_class;
};

struct _MovementSystemPrivate {
	Camera* camera;
};

typedef enum  {
	POSITION_COMPONENT_ENTITY_STATE_GROUND,
	POSITION_COMPONENT_ENTITY_STATE_AIR
} PositionComponentEntityState;

struct _PositionComponent {
	EngineComponent parent_instance;
	PositionComponentPrivate * priv;
	gint x;
	gint y;
	gint velocity_x;
	gint velocity_y;
	PositionComponentEntityState state;
	SDL_RendererFlip flip;
};

struct _PositionComponentClass {
	EngineComponentClass parent_class;
};

struct _AnimationComponent {
	EngineComponent parent_instance;
	AnimationComponentPrivate * priv;
	gchar* current_animation;
	gint sprite_width;
};

struct _AnimationComponentClass {
	EngineComponentClass parent_class;
};

struct _RenderComponent {
	EngineComponent parent_instance;
	RenderComponentPrivate * priv;
	gchar* identifier;
	gchar* sprite_filename;
	guint w;
	guint h;
};

struct _RenderComponentClass {
	EngineComponentClass parent_class;
};


static gpointer movement_system_parent_class = NULL;

GType movement_system_get_type (void) G_GNUC_CONST;
gpointer camera_ref (gpointer instance);
void camera_unref (gpointer instance);
GParamSpec* param_spec_camera (const gchar* name, const gchar* nick, const gchar* blurb, GType object_type, GParamFlags flags);
void value_set_camera (GValue* value, gpointer v_object);
void value_take_camera (GValue* value, gpointer v_object);
gpointer value_get_camera (const GValue* value);
GType camera_get_type (void) G_GNUC_CONST;
#define MOVEMENT_SYSTEM_GET_PRIVATE(o) (G_TYPE_INSTANCE_GET_PRIVATE ((o), TYPE_MOVEMENT_SYSTEM, MovementSystemPrivate))
enum  {
	MOVEMENT_SYSTEM_DUMMY_PROPERTY
};
MovementSystem* movement_system_new (Camera* camera);
MovementSystem* movement_system_construct (GType object_type, Camera* camera);
static GType* movement_system_real_getEntityTypes (EngineEntitySystem* base, int* result_length1);
GType movement_component_get_type (void) G_GNUC_CONST;
GType position_component_get_type (void) G_GNUC_CONST;
static void movement_system_real_update (EngineSystem* base, gfloat deltaTime);
static guint8* _vala_array_dup1 (guint8* self, int length);
GType animation_component_get_type (void) G_GNUC_CONST;
GType render_component_get_type (void) G_GNUC_CONST;
guint camera_get_w (Camera* self);
GType position_component_entity_state_get_type (void) G_GNUC_CONST;
gint camera_get_x (Camera* self);
void camera_set_x (Camera* self, gint value);
RenderComponent* render_component_new (const gchar* identifier, const gchar* sprite_filename, guint w, guint h);
RenderComponent* render_component_construct (GType object_type, const gchar* identifier, const gchar* sprite_filename, guint w, guint h);
PositionComponent* position_component_new (gint x, gint y);
PositionComponent* position_component_construct (GType object_type, gint x, gint y);
AnimationComponent* animation_component_new (void);
AnimationComponent* animation_component_construct (GType object_type);
GType animation_get_type (void) G_GNUC_CONST;
void animation_component_add_animation (AnimationComponent* self, Animation* a);
Animation* animation_new (const gchar* name, gint begin, gint end, gint frames_between, gboolean endless, gboolean removeAfterAnimation);
Animation* animation_construct (GType object_type, const gchar* name, gint begin, gint end, gint frames_between, gboolean endless, gboolean removeAfterAnimation);
static void movement_system_finalize (GObject* obj);


MovementSystem* movement_system_construct (GType object_type, Camera* camera) {
	MovementSystem * self = NULL;
	Camera* _tmp0_ = NULL;
	g_return_val_if_fail (camera != NULL, NULL);
	self = (MovementSystem*) engine_entity_system_construct (object_type);
	_tmp0_ = camera;
	self->priv->camera = _tmp0_;
	return self;
}


MovementSystem* movement_system_new (Camera* camera) {
	return movement_system_construct (TYPE_MOVEMENT_SYSTEM, camera);
}


static GType* movement_system_real_getEntityTypes (EngineEntitySystem* base, int* result_length1) {
	MovementSystem * self;
	GType* result = NULL;
	GType* _tmp0_ = NULL;
	GType* _tmp1_ = NULL;
	gint _tmp1__length1 = 0;
	self = (MovementSystem*) base;
	_tmp0_ = g_new0 (GType, 2);
	_tmp0_[0] = TYPE_MOVEMENT_COMPONENT;
	_tmp0_[1] = TYPE_POSITION_COMPONENT;
	_tmp1_ = _tmp0_;
	_tmp1__length1 = 2;
	if (result_length1) {
		*result_length1 = _tmp1__length1;
	}
	result = _tmp1_;
	return result;
}


static guint8* _vala_array_dup1 (guint8* self, int length) {
	return g_memdup (self, length * sizeof (guint8));
}


static gpointer _g_object_ref0 (gpointer self) {
	return self ? g_object_ref (self) : NULL;
}


static void movement_system_real_update (EngineSystem* base, gfloat deltaTime) {
	MovementSystem * self;
	guint8* keyboardstate = NULL;
	gint _tmp0_ = 0;
	guint8* _tmp1_ = NULL;
	guint8* _tmp2_ = NULL;
	gint _tmp2__length1 = 0;
	gint keyboardstate_length1 = 0;
	gint _keyboardstate_size_ = 0;
	EngineEngine* _tmp3_ = NULL;
	EngineState _tmp4_ = 0;
	self = (MovementSystem*) base;
	_tmp1_ = SDL_GetKeyboardState (&_tmp0_);
	_tmp2_ = (_tmp1_ != NULL) ? _vala_array_dup1 (_tmp1_, _tmp0_) : ((gpointer) _tmp1_);
	_tmp2__length1 = _tmp0_;
	keyboardstate = _tmp2_;
	keyboardstate_length1 = _tmp2__length1;
	_keyboardstate_size_ = keyboardstate_length1;
	_tmp3_ = ((EngineSystem*) self)->engine;
	_tmp4_ = _tmp3_->state;
	if (_tmp4_ != ENGINE_STATE_PAUSED) {
		{
			GeeList* _e_list = NULL;
			GeeList* _tmp5_ = NULL;
			GeeList* _tmp6_ = NULL;
			gint _e_size = 0;
			GeeList* _tmp7_ = NULL;
			gint _tmp8_ = 0;
			gint _tmp9_ = 0;
			gint _e_index = 0;
			_tmp5_ = ((EngineEntitySystem*) self)->entities;
			_tmp6_ = _g_object_ref0 (_tmp5_);
			_e_list = _tmp6_;
			_tmp7_ = _e_list;
			_tmp8_ = gee_collection_get_size ((GeeCollection*) _tmp7_);
			_tmp9_ = _tmp8_;
			_e_size = _tmp9_;
			_e_index = -1;
			while (TRUE) {
				gint _tmp10_ = 0;
				gint _tmp11_ = 0;
				gint _tmp12_ = 0;
				EngineEntity* e = NULL;
				GeeList* _tmp13_ = NULL;
				gint _tmp14_ = 0;
				gpointer _tmp15_ = NULL;
				PositionComponent* pos = NULL;
				EngineEntity* _tmp16_ = NULL;
				gpointer _tmp17_ = NULL;
				AnimationComponent* ani = NULL;
				EngineEntity* _tmp18_ = NULL;
				gpointer _tmp19_ = NULL;
				RenderComponent* rend = NULL;
				EngineEntity* _tmp20_ = NULL;
				gpointer _tmp21_ = NULL;
				Camera* _tmp22_ = NULL;
				guint _tmp23_ = 0U;
				guint _tmp24_ = 0U;
				PositionComponent* _tmp25_ = NULL;
				gint _tmp26_ = 0;
				guint8* _tmp27_ = NULL;
				gint _tmp27__length1 = 0;
				guint8 _tmp28_ = 0U;
				gboolean _tmp80_ = FALSE;
				guint8* _tmp81_ = NULL;
				gint _tmp81__length1 = 0;
				guint8 _tmp82_ = 0U;
				_tmp10_ = _e_index;
				_e_index = _tmp10_ + 1;
				_tmp11_ = _e_index;
				_tmp12_ = _e_size;
				if (!(_tmp11_ < _tmp12_)) {
					break;
				}
				_tmp13_ = _e_list;
				_tmp14_ = _e_index;
				_tmp15_ = gee_list_get (_tmp13_, _tmp14_);
				e = (EngineEntity*) _tmp15_;
				_tmp16_ = e;
				_tmp17_ = engine_entity_get_component (_tmp16_, TYPE_POSITION_COMPONENT, (GBoxedCopyFunc) g_object_ref, g_object_unref);
				pos = (PositionComponent*) _tmp17_;
				_tmp18_ = e;
				_tmp19_ = engine_entity_get_component (_tmp18_, TYPE_ANIMATION_COMPONENT, (GBoxedCopyFunc) g_object_ref, g_object_unref);
				ani = (AnimationComponent*) _tmp19_;
				_tmp20_ = e;
				_tmp21_ = engine_entity_get_component (_tmp20_, TYPE_RENDER_COMPONENT, (GBoxedCopyFunc) g_object_ref, g_object_unref);
				rend = (RenderComponent*) _tmp21_;
				_tmp22_ = self->priv->camera;
				_tmp23_ = camera_get_w (_tmp22_);
				_tmp24_ = _tmp23_;
				_tmp25_ = pos;
				_tmp26_ = _tmp25_->x;
				g_debug ("movementsystem.vala:26: camerawidth %u pos.x %d", _tmp24_, _tmp26_);
				_tmp27_ = keyboardstate;
				_tmp27__length1 = keyboardstate_length1;
				_tmp28_ = _tmp27_[SDL_SCANCODE_LEFT];
				if (((gint) _tmp28_) == 1) {
					AnimationComponent* _tmp29_ = NULL;
					PositionComponent* _tmp32_ = NULL;
					gint _tmp33_ = 0;
					PositionComponent* _tmp53_ = NULL;
					_tmp29_ = ani;
					if (_tmp29_ != NULL) {
						AnimationComponent* _tmp30_ = NULL;
						gchar* _tmp31_ = NULL;
						_tmp30_ = ani;
						_tmp31_ = g_strdup ("running");
						_g_free0 (_tmp30_->current_animation);
						_tmp30_->current_animation = _tmp31_;
					}
					_tmp32_ = pos;
					_tmp33_ = _tmp32_->x;
					if (_tmp33_ >= 0) {
						gboolean _tmp34_ = FALSE;
						PositionComponent* _tmp35_ = NULL;
						gint _tmp36_ = 0;
						RenderComponent* _tmp37_ = NULL;
						guint _tmp38_ = 0U;
						Camera* _tmp39_ = NULL;
						gint _tmp40_ = 0;
						gint _tmp41_ = 0;
						Camera* _tmp42_ = NULL;
						guint _tmp43_ = 0U;
						guint _tmp44_ = 0U;
						_tmp35_ = pos;
						_tmp36_ = _tmp35_->x;
						_tmp37_ = rend;
						_tmp38_ = _tmp37_->w;
						_tmp39_ = self->priv->camera;
						_tmp40_ = camera_get_x (_tmp39_);
						_tmp41_ = _tmp40_;
						_tmp42_ = self->priv->camera;
						_tmp43_ = camera_get_w (_tmp42_);
						_tmp44_ = _tmp43_;
						if (((_tmp36_ + (_tmp38_ / 2)) - _tmp41_) < (_tmp44_ / 2)) {
							Camera* _tmp45_ = NULL;
							gint _tmp46_ = 0;
							gint _tmp47_ = 0;
							_tmp45_ = self->priv->camera;
							_tmp46_ = camera_get_x (_tmp45_);
							_tmp47_ = _tmp46_;
							_tmp34_ = _tmp47_ != 0;
						} else {
							_tmp34_ = FALSE;
						}
						if (_tmp34_) {
							Camera* _tmp48_ = NULL;
							Camera* _tmp49_ = NULL;
							gint _tmp50_ = 0;
							gint _tmp51_ = 0;
							_tmp48_ = self->priv->camera;
							_tmp49_ = self->priv->camera;
							_tmp50_ = camera_get_x (_tmp49_);
							_tmp51_ = _tmp50_;
							camera_set_x (_tmp49_, _tmp51_ - 2);
						} else {
							PositionComponent* _tmp52_ = NULL;
							_tmp52_ = pos;
							_tmp52_->velocity_x = -2;
						}
					}
					_tmp53_ = pos;
					_tmp53_->flip = SDL_FLIP_HORIZONTAL;
				} else {
					guint8* _tmp54_ = NULL;
					gint _tmp54__length1 = 0;
					guint8 _tmp55_ = 0U;
					_tmp54_ = keyboardstate;
					_tmp54__length1 = keyboardstate_length1;
					_tmp55_ = _tmp54_[SDL_SCANCODE_RIGHT];
					if (((gint) _tmp55_) == 1) {
						AnimationComponent* _tmp56_ = NULL;
						PositionComponent* _tmp59_ = NULL;
						gint _tmp60_ = 0;
						gint _tmp61_ = 0;
						RenderComponent* _tmp62_ = NULL;
						guint _tmp63_ = 0U;
						Camera* _tmp64_ = NULL;
						gint _tmp65_ = 0;
						gint _tmp66_ = 0;
						Camera* _tmp67_ = NULL;
						guint _tmp68_ = 0U;
						guint _tmp69_ = 0U;
						PositionComponent* _tmp75_ = NULL;
						_tmp56_ = ani;
						if (_tmp56_ != NULL) {
							AnimationComponent* _tmp57_ = NULL;
							gchar* _tmp58_ = NULL;
							_tmp57_ = ani;
							_tmp58_ = g_strdup ("running");
							_g_free0 (_tmp57_->current_animation);
							_tmp57_->current_animation = _tmp58_;
						}
						_tmp59_ = pos;
						_tmp60_ = _tmp59_->x;
						_tmp61_ = abs (_tmp60_);
						_tmp62_ = rend;
						_tmp63_ = _tmp62_->w;
						_tmp64_ = self->priv->camera;
						_tmp65_ = camera_get_x (_tmp64_);
						_tmp66_ = _tmp65_;
						_tmp67_ = self->priv->camera;
						_tmp68_ = camera_get_w (_tmp67_);
						_tmp69_ = _tmp68_;
						if (((_tmp61_ + (_tmp63_ / 2)) - _tmp66_) > (_tmp69_ / 2)) {
							Camera* _tmp70_ = NULL;
							Camera* _tmp71_ = NULL;
							gint _tmp72_ = 0;
							gint _tmp73_ = 0;
							_tmp70_ = self->priv->camera;
							_tmp71_ = self->priv->camera;
							_tmp72_ = camera_get_x (_tmp71_);
							_tmp73_ = _tmp72_;
							camera_set_x (_tmp71_, _tmp73_ + 2);
						} else {
							PositionComponent* _tmp74_ = NULL;
							_tmp74_ = pos;
							_tmp74_->velocity_x = 2;
						}
						_tmp75_ = pos;
						_tmp75_->flip = SDL_FLIP_NONE;
					} else {
						PositionComponent* _tmp76_ = NULL;
						AnimationComponent* _tmp77_ = NULL;
						_tmp76_ = pos;
						_tmp76_->velocity_x = 0;
						_tmp77_ = ani;
						if (_tmp77_ != NULL) {
							AnimationComponent* _tmp78_ = NULL;
							gchar* _tmp79_ = NULL;
							_tmp78_ = ani;
							_tmp79_ = g_strdup ("still");
							_g_free0 (_tmp78_->current_animation);
							_tmp78_->current_animation = _tmp79_;
						}
					}
				}
				_tmp81_ = keyboardstate;
				_tmp81__length1 = keyboardstate_length1;
				_tmp82_ = _tmp81_[SDL_SCANCODE_UP];
				if (((gint) _tmp82_) == 1) {
					PositionComponent* _tmp83_ = NULL;
					PositionComponentEntityState _tmp84_ = 0;
					_tmp83_ = pos;
					_tmp84_ = _tmp83_->state;
					_tmp80_ = _tmp84_ != POSITION_COMPONENT_ENTITY_STATE_AIR;
				} else {
					_tmp80_ = FALSE;
				}
				if (_tmp80_) {
					PositionComponent* _tmp85_ = NULL;
					PositionComponent* _tmp86_ = NULL;
					gint _tmp87_ = 0;
					PositionComponent* _tmp88_ = NULL;
					EngineEntity* ent = NULL;
					EngineEngine* _tmp89_ = NULL;
					EngineEntity* _tmp90_ = NULL;
					EngineEntity* _tmp91_ = NULL;
					RenderComponent* _tmp92_ = NULL;
					RenderComponent* _tmp93_ = NULL;
					EngineEntity* _tmp94_ = NULL;
					PositionComponent* _tmp95_ = NULL;
					gint _tmp96_ = 0;
					PositionComponent* _tmp97_ = NULL;
					gint _tmp98_ = 0;
					RenderComponent* _tmp99_ = NULL;
					guint _tmp100_ = 0U;
					PositionComponent* _tmp101_ = NULL;
					PositionComponent* _tmp102_ = NULL;
					AnimationComponent* anic = NULL;
					AnimationComponent* _tmp103_ = NULL;
					AnimationComponent* _tmp104_ = NULL;
					Animation* _tmp105_ = NULL;
					Animation* _tmp106_ = NULL;
					EngineEntity* _tmp107_ = NULL;
					AnimationComponent* _tmp108_ = NULL;
					_tmp85_ = pos;
					_tmp86_ = pos;
					_tmp87_ = _tmp86_->velocity_y;
					_tmp86_->velocity_y = _tmp87_ - 9;
					_tmp88_ = pos;
					_tmp88_->state = POSITION_COMPONENT_ENTITY_STATE_AIR;
					_tmp89_ = ((EngineSystem*) self)->engine;
					_tmp90_ = engine_engine_createEntity (_tmp89_);
					ent = _tmp90_;
					_tmp91_ = ent;
					_tmp92_ = render_component_new ("fxjump", "data/fxjump.png", (guint) 18, (guint) 6);
					_tmp93_ = _tmp92_;
					engine_entity_add_component (_tmp91_, (EngineComponent*) _tmp93_);
					_g_object_unref0 (_tmp93_);
					_tmp94_ = ent;
					_tmp95_ = pos;
					_tmp96_ = _tmp95_->x;
					_tmp97_ = pos;
					_tmp98_ = _tmp97_->y;
					_tmp99_ = rend;
					_tmp100_ = _tmp99_->h;
					_tmp101_ = position_component_new (_tmp96_ + 6, (_tmp98_ + ((gint) _tmp100_)) - 6);
					_tmp102_ = _tmp101_;
					engine_entity_add_component (_tmp94_, (EngineComponent*) _tmp102_);
					_g_object_unref0 (_tmp102_);
					_tmp103_ = animation_component_new ();
					anic = _tmp103_;
					_tmp104_ = anic;
					_tmp105_ = animation_new ("jump", 0, 6, 1, FALSE, TRUE);
					_tmp106_ = _tmp105_;
					animation_component_add_animation (_tmp104_, _tmp106_);
					_g_object_unref0 (_tmp106_);
					_tmp107_ = ent;
					_tmp108_ = anic;
					engine_entity_add_component (_tmp107_, (EngineComponent*) _tmp108_);
					_g_object_unref0 (anic);
					_g_object_unref0 (ent);
				}
				_g_object_unref0 (rend);
				_g_object_unref0 (ani);
				_g_object_unref0 (pos);
				_g_object_unref0 (e);
			}
			_g_object_unref0 (_e_list);
		}
	}
	keyboardstate = (g_free (keyboardstate), NULL);
}


static void movement_system_class_init (MovementSystemClass * klass) {
	movement_system_parent_class = g_type_class_peek_parent (klass);
	g_type_class_add_private (klass, sizeof (MovementSystemPrivate));
	((EngineEntitySystemClass *) klass)->getEntityTypes = movement_system_real_getEntityTypes;
	((EngineSystemClass *) klass)->update = movement_system_real_update;
	G_OBJECT_CLASS (klass)->finalize = movement_system_finalize;
}


static void movement_system_instance_init (MovementSystem * self) {
	self->priv = MOVEMENT_SYSTEM_GET_PRIVATE (self);
}


static void movement_system_finalize (GObject* obj) {
	MovementSystem * self;
	self = G_TYPE_CHECK_INSTANCE_CAST (obj, TYPE_MOVEMENT_SYSTEM, MovementSystem);
	G_OBJECT_CLASS (movement_system_parent_class)->finalize (obj);
}


GType movement_system_get_type (void) {
	static volatile gsize movement_system_type_id__volatile = 0;
	if (g_once_init_enter (&movement_system_type_id__volatile)) {
		static const GTypeInfo g_define_type_info = { sizeof (MovementSystemClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) movement_system_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (MovementSystem), 0, (GInstanceInitFunc) movement_system_instance_init, NULL };
		GType movement_system_type_id;
		movement_system_type_id = g_type_register_static (ENGINE_TYPE_ENTITY_SYSTEM, "MovementSystem", &g_define_type_info, 0);
		g_once_init_leave (&movement_system_type_id__volatile, movement_system_type_id);
	}
	return movement_system_type_id__volatile;
}



